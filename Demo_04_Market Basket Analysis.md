### 1. 创建sample数据集
    USE ROLE SYSADMIN;
    CREATE OR REPLACE DATABASE DEMO3D_DB;
    CREATE OR REPLACE TABLE DEMO3D_DB.PUBLIC.SALES AS
    (SELECT * FROM SNOWFLAKE_SAMPLE_DATA.TPCDS_SF100TCL.WEB_SALES)
    LIMIT 100000;

### 2. 关联查询
    SELECT 1 AS INPUT_ITEM, WS_WEB_SITE_SK AS BASKET_ITEM,
    COUNT (DISTINCT WS_ORDER_NUMBER) BASKETS
    FROM DEMO3D_DB.PUBLIC.SALES
    WHERE WS_ORDER_NUMBER IN
    (SELECT WS_ORDER_NUMBER
    FROM DEMO3D_DB.PUBLIC.SALES
    WHERE WS_WEB_SITE_SK = 1)
    GROUP BY WS_WEB_SITE_SK
    ORDER BY 3 DESC, 2;

### 3.创建secure UDF
    USE ROLE SYSADMIN;
    CREATE OR REPLACE SECURE FUNCTION
    DEMO3D_DB.PUBLIC.GET_MKTBASKET(INPUT_WEB_SITE_SK number(38))
    RETURNS TABLE (INPUT_ITEM NUMBER(38, 0), BASKET_ITEM NUMBER(38, 0),
    BASKETS NUMBER(38, 0)) AS
    'SELECT input_web_site_sk, WS_WEB_SITE_SK as BASKET_ITEM,
    COUNT(DISTINCT WS_ORDER_NUMBER) BASKETS
    FROM DEMO3D_DB.PUBLIC.SALES
    WHERE WS_ORDER_NUMBER IN
    (SELECT WS_ORDER_NUMBER
    FROM DEMO3D_DB.PUBLIC.SALES
    WHERE WS_WEB_SITE_SK = input_web_site_sk)
    GROUP BY ws_web_site_sk
    ORDER BY 3 DESC, 2';
